class DetectivesGameSM {
  game {
    game_setup {
      start_game_button_clicked -> map_view;
    }
    
    map_view {
      
      entry / {
        drawMap();
        drawStatus();
      }
      
      [canGuess() && hasMoves()] clicks_on_estate -> guess_popup;
      [hasMoves()] click_on_empty_tile -> map_view;
      
      clicks_exit_button -> exited;
      
      finish_turn_btn_click -> waiting_for_next_player;
    }
    
    guess_popup {
      
      entry / { openPopup(); 
              	confirm -> waiting_for_next_refuter;
              }
      
      confirm -> waiting_for_next_refuter;
      cancel -> waiting_for_next_player;
      
      exit / { closePopup(); }
    }
    
    refute_guess {
      player_refutes_guess -> waiting_for_next_refuter;
      
      finished_refuting -> waiting_for_next_refuter;
    }
    
    waiting_for_next_refuter {
      player_confirms_presence -> refute_guess;
    }
    
    exited {
      entry / { System.exit(0); }
      // this state can never be exited
    }
    
    waiting_for_next_player {
      
      entry / {
        clearScreen();
        popupPlayerTransition();
      }
      
      player_confirms_presence -> map_view;
      
    }
  }
}
